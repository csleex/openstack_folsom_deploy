<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Openstack folsom deploy by jedipunkz</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Openstack folsom deploy</h1>
          <h2>OpenStack Folsom bootstrap script for Ubuntu Server 12.04 LTS</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/jedipunkz/openstack_folsom_deploy/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/jedipunkz/openstack_folsom_deploy/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/jedipunkz/openstack_folsom_deploy" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>OpenStack Folsom Bootstrap Script</h1>

<p>OpenStack Folsom Bootstrap Script for Ubuntu Server</p>

<h2>Author</h2>

<p>Tomokazu Hirai <a href="https://github.com/jedipunkz" class="user-mention">@jedipunkz</a></p>

<h2>Notice</h2>

<p>This script code was tested only for all in one installation and additional compuote installation. Now I am
developing for separated compornent nodes, and addtitional compute nodes.
Please wait a moment :D or Feel FREE for your fork.</p>

<h2>Motivation</h2>

<p>devstack is very usefull for me. I am using devstack for understanding
openstack and especially Quantum ! ;) but when I reboot devstack node, all of
openstack compornents was not booted. That is not good for me. and I wanted to
use Ubuntu Cloud Archive packages.</p>

<h2>Premise Environment</h2>

<p>You need 1 or more node(s) with Ubuntu Server 12.04 LTS / 12.10.</p>

<p>You should have a machine with 3 NICs. eth0 is public network interface. eth1
is VM (data) network interface, this will be used for communication to other
VMs on other compute nodes. eth2 is completely for management.</p>

<p>Quantum was designed based on 4 networks, public/data/management/api. This script
designed based on 3 networks (if you want 4 networks, you can do it with this).
public/data/management &amp; api. All of APIs will be listening on management networks
interface.</p>

<pre><code>    management segment 172.16.1.0/24                                                                                                                                             
    +--------------------------------------------                                                                                                                                
    | eth2 172.16.1.11                           eth2 172.16.1.12                                                                                                                
    +------------+                               +-----------+                                                                                                                   
    |            | eth1 ------------------- eth1 |           |                                                                                                                   
    | controller | vlan/gre seg = 172.24.17.0/24 | compute01 | ..&gt; adding                                                                                                        
    |            | data segment = 172.16.2.0/24  |           |                                                                                                                   
    +------------+ 172.16.2.11       172.16.2.12 +-----------+                                                                                                                   
    | eth0                                       eth0                                                                                                                            
    |                                            +--------+                                                                                                                      
    +--------------------------------------------| Router |--&gt; The Internet                                                                                                      
            public segment 10.200.8.0/24         +--------+ 
</code></pre>

<p>so you should setup each NICs like this. this is /etc/network/interface</p>

<pre><code># The loopback network interface
auto lo
iface lo inet loopback

auto eth0
iface eth0 inet static
    up ifconfig $IFACE 0.0.0.0 up
    down ifconfig $IFACE down
    address 10.200.8.10
    netmask 255.255.255.0
    dns-nameservers 8.8.8.8
    dns-search cpi.ad.jp

auto eth1
iface eth1 inet static
    address 172.26.2.11
    netmask 255.255.255.0

auto eth2
iface eth2 inet static
    address 172.16.1.11
    netmask 255.255.255.0
    gateway 172.16.1.1
    dns-nameservers 8.8.8.8 8.8.4.4
</code></pre>

<p>You can install and manage openstack via eth2 NiC. When you run this script,
openvswitch will adding eth0 and eth1 for bridge interfaces.</p>

<p>and Especialy you need to have a disk device for cinder such as /dev/sda6.</p>

<h2>How to use</h2>

<p>get script to your target.</p>

<pre><code>% git clone https://github.com/jedipunkz/openstack_folsom_deploy.git
% cd openstack_folsom_deploy
</code></pre>

<p>Update these environment in deploy.conf</p>

<pre><code># for all in one (controller)
HOST_IP='172.16.1.11'
# for separated nodes (in near future, I support these parameters)
NOVA_IP='172.16.1.11'
KEYSTONE_IP='172.16.1.11'
GLANCE_IP='172.16.1.11'
CINDER_IP='172.16.1.11'
DB_IP='172.16.1.11'
QUANTUM_IP='172.16.1.11'
RABBIT_IP='172.16.1.11'
# etc env
MYSQL_PASS='secret'
CINDER_VOLUME='/dev/sda6'
DATA_NIC='eth1'
PUBLIC_NIC='eth0'
# network_type : gre or vlan
NETWORK_TYPE='vlan'
# additional compute (compute)
ADD_NOVA_IP='172.16.1.12'
DATA_NIC_COMPUTE='eth1'

# quantun env
INT_NET_GATEWAY='172.24.17.254'
INT_NET_RANGE='172.24.17.0/24'
EXT_NET_GATEWAY='10.200.8.1'
EXT_NET_START='10.200.8.36'
EXT_NET_END='10.200.8.40'
EXT_NET_RANGE='10.200.8.0/24'
</code></pre>

<p>Run this script.</p>

<pre><code>% sudo ./deploy.sh controller
</code></pre>

<p>That's all and You've done :D</p>

<p>Now you can create and boot VMs on Horizon (http://${HOST_IP}/horizon)  with user: demo, pass: demo.</p>

<h4>Additional Compute Node</h4>

<p>If you have a plan to build additinal compute nodes, please run deploy.sh with 'compute' option.
parameters of deploy.conf must be same as controller's one.</p>

<pre><code>% scp -r &lt;controller_ip&gt;:~/openstack_folsom_deploy .
% cd openstack_folsom_deploy
% sudo ./deploy.sh compute
</code></pre>

<p>check your nova status with this command :</p>

<pre><code>% sudo nova-manage service list
Binary           Host                                 Zone             Status     State Updated_At
nova-cert        opst-folsom01                        nova             enabled    :-)   2012-11-02 10:10:07
nova-consoleauth opst-folsom01                        nova             enabled    :-)   2012-11-02 10:10:07
nova-compute     opst-folsom01                        nova             enabled    :-)   2012-11-02 10:10:13
nova-scheduler   opst-folsom01                        nova             enabled    :-)   2012-11-02 10:10:07
nova-compute     opst-folsom02                        nova             enabled    :-)   2012-11-02 10:10:16
</code></pre>

<p>Need more compute node(s) ? you can do it.</p>

<pre><code>% scp -r &lt;controller_ip&gt;:~/openstack_folsom_deploy .
% cd openstack_folsom_deploy
% vim deploy.conf # update $ADD_NOVA_IP
% sudo ./deploy.sh compute
</code></pre>

<h2>Using floating ip</h2>

<p>If you want to use floating ip, do these operation.</p>

<pre><code>% source ~/openstackrc
% quantum net-list
% quantun floatingip-create &lt;ext_net_id&gt;
% quantun floatingip-list
% quantum port-list
% quantum floatingip-associate &lt;floatingip_id&gt; &lt;vm_port_id&gt;
</code></pre>

<h2>Enabling to access to VMs</h2>

<p>If you want to access to VMs from anyware, do these operation.</p>

<pre><code>% source $HOME/openstackrc
% nova secgroup-add-rule default tcp 22 22 0.0.0.0/0
% nova secgroup-add-rule default icmp -1 -1 0.0.0.0/0
% nova secgroup-list-rules default
</code></pre>

<h2>Versions and Changelog</h2>

<ul>
<li>2012/11/01 : version 0.1 : First Release.</li>
<li>2012/11/08 : version 0.2 : Supported VLAN mode of quantum.</li>
</ul>
        </section>

        <footer>
          Openstack folsom deploy is maintained by <a href="https://github.com/jedipunkz">jedipunkz</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.
        </footer>

                  <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-30563095-3");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

      </div>
    </div>
  </body>
</html>